#include "capturethread.h"

worker::worker(QWaitCondition *q, CaptureCamera *cam, QObject *parent) :
  QObject(parent)
{
    running = false;
    line = q;
    cam = cam;
}

void worker::do_Work()
{
  forever
  {
      mutex.lock();
      if (!running)
      {
          mutex.unlock();
          break;
      }

      result = cam->RecordNextFrame();

      emit ResultReady(result);

      if(!line->wait(&mutex,1000))
      {
         qDebug() << "signal lost";
      }
      mutex.unlock();

      QCoreApplication::processEvents();
  }

  qDebug() << "Stopping capture thread";
}

void worker::StopWork()
{
    QMutexLocker l(&mutex);
    running = false;
}

void worker::StartWork()
{
    running = true;
    do_Work();
}
